## 负载均衡

在多台服务器运行的情况下，将用户流量分发到不同的服务器上。负载均衡分为以下两种：
* 四层负载均衡
* 七层负载均衡

### 四层负载均衡
四层负载均衡工作在OSI模型的传输层。主要工作是转发。或者来自客户端的流量后，修改数据包的目的地地址，将流量转发到服务器。

### 七层负载均衡
七层负载均衡工作在OSI模型的应用层。主要工作是代理。七层负载均衡与客户端建立完整连接，解析客户端的请求流量。根据调度算法选择应用服务器，并于该服务器建立另外一条连接，发送请求。

![示意图](https://upload-images.jianshu.io/upload_images/1935978-c97914af04e9ca8a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## 负载均衡的实现

1. DNS域名解析
2. 数据链路层(LVS)
3. IP层
4. http重定向
5. 反向代理

* DNS域名解析负载均衡

在DNS服务器中配置多个域名记录，每次域名解析请求会根据负载均衡算法计算一个不同的IP地址返回。

* 数据链路层负载均衡

配置服务器集群的虚拟IP和负载均衡的IP地址一致。修改客户端请求的目的MAC地址，而不修改目的IP地址。在请求数据被处理后，响应数据可以经过网关服务器直接到达用户浏览器。

数据链路层负载均衡，是目前较为常见的负载均衡实现手段。

* IP负载均衡(SNAT)

在网络层通过修改请求的目的地址和源地址，实现负载均衡。负载均衡服务器修改用户请求的数据包的目的地址和源地址，以及web服务器的响应数据包的目的地址和源地址。

IP负载均衡在内核进程完成数据分发，较反向代理均衡有更好的处理性能。但对负载均衡的网卡带宽会有要求。

* HTTP重定向负载均衡

HTTP重定向服务器，根据请求计算真实web服务器的地址，将地址写入重定向响应后返回给客户端。由于客户端需要请求两次才能获取结果，效率较低。

* 反向代理负载均衡
 
反向代理服务器转发请求在HTTP协议层面，因此也叫应用层负载均衡。优点是部署简单，缺点是可能成为系统的瓶颈。


**参考**

[负载均衡算法及手段](https://segmentfault.com/a/1190000004492447)