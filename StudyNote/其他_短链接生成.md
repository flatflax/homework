# 短链接生成

之前看某公司的实习要求是需要能写出短链接和图床相关难度的服务，同时之前有看过一些短链接生成的原理，所以想在这里记录一下看到的关于短链接生成的原理或者实践相关的内容。~~说得好像自己能做一样~~

## 原理

1. 对url进行hash计算

对url进行hash计算，在得到的结果进行进一步计算，以获得一个较短的值。可能会出现碰撞。

2. 自增id

通过数据库自增ID或分布式key-value系统模拟发号器进行发号压缩URL。

用户提供一个长链接，发号器给该长连接赋予一个id（号码），并对这个id计算散列值或进行62进制的转换，然后一并存储，向用户返回的是id的散列值/转换后的id。当用户访问短链接时，返回长连接。id组成：阿拉伯数字+小写字母+大写字母（62进制） 在6位id的情况下就已经可以支持56亿个长连接的转换了。

可以将id和长链接的映射存储在缓存服务器中，并设定一定的过期时间，并根据其活跃程度在决定延长活跃时间与否。

## 其他

* 短链接的跳转： 301还是302？

	* 使用301 ： 永久重定向
	用户在第一次访问短链接之后，假如后续进行多次访问，则浏览器会直接访问跳转地址，而不会对服务器造成负担。但是这种情况下服务器不会得到用户的相关请求，也无法收集用户的访问行为。

	* 使用302 ： 临时重定向
	浏览器不缓存短链接的跳转，用户每次访问短链接都会先向服务器发送请求，服务器在表中获取长链接并重定向。会对服务器造成负担，但是可以收集用户的访问行为。

* 发号机

创建多个发号机的情况下，调整发号机在每次发号后的id自增量。

可以使用Redis的INCR函数自增1
或者在有多个发号机的情况下，使用INCRBY自增一个整数

* 缓存

Redis